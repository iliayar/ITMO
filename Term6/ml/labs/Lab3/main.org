#+title: Lab 3

#+begin_src jupyter-julia
include("main.jl") 
#+end_src

#+RESULTS:
: # Out[74]:
: : read_dataframe (generic function with 1 method)

* Loading libraries
#+begin_src jupyter-julia
using CSV
using DataFrames
#+end_src

#+RESULTS:
: # Out[2]:

* Loading dataset
#+begin_src jupyter-julia
X_chips, y_chips = read_dataframe("./data/chips.csv");
X_geyser, y_geyser = read_dataframe("./data/geyser.csv");
#+end_src

#+RESULTS:
: # Out[3]:

* Finding best
#+begin_src jupyter-julia :result output
res_chips = find_best(X_chips, y_chips)
#+end_src

#+RESULTS:
#+begin_example
# Out[75]:
,#+BEGIN_EXAMPLE
  80-element Vector{Any}:
  (0.4153846153846154, (:linear, (), 0.05))
  (0.5002136752136752, (:linear, (), 0.1))
  (0.5085470085470085, (:linear, (), 0.5))
  (0.4916666666666667, (:linear, (), 1.0))
  (0.5170940170940171, (:linear, (), 5.0))
  (0.5256410256410255, (:linear, (), 10.0))
  (0.5341880341880342, (:linear, (), 50.0))
  (0.533974358974359, (:linear, (), 100.0))
  (0.4743589743589743, (:polynomial, 2, 0.05))
  (0.432051282051282, (:polynomial, 2, 0.1))
  (0.4997863247863248, (:polynomial, 2, 0.5))
  (0.5081196581196582, (:polynomial, 2, 1.0))
  (0.5425213675213675, (:polynomial, 2, 5.0))
  ⋮
  (0.517094017094017, (:gauss, 4, 5.0))
  (0.5423076923076923, (:gauss, 4, 10.0))
  (0.533974358974359, (:gauss, 4, 50.0))
  (0.5512820512820512, (:gauss, 4, 100.0))
  (0.5256410256410257, (:gauss, 5, 0.05))
  (0.48333333333333334, (:gauss, 5, 0.1))
  (0.5002136752136752, (:gauss, 5, 0.5))
  (0.49166666666666664, (:gauss, 5, 1.0))
  (0.5254273504273503, (:gauss, 5, 5.0))
  (0.5596153846153845, (:gauss, 5, 10.0))
  (0.5423076923076923, (:gauss, 5, 50.0))
  (0.48269230769230775, (:gauss, 5, 100.0))
,#+END_EXAMPLE
#+end_example

#+begin_src jupyter-julia
res_geyser = find_best(X_geyser, y_geyser)
#+end_src
#+RESULTS:
#+begin_example
# Out[55]:
,#+BEGIN_EXAMPLE
  80-element Vector{Any}:
  (0.6036363636363636, (:linear, (), 0.05))
  (0.6036363636363636, (:linear, (), 0.1))
  (0.6036363636363636, (:linear, (), 0.5))
  (0.6036363636363636, (:linear, (), 1.0))
  (0.6036363636363636, (:linear, (), 5.0))
  (0.6036363636363636, (:linear, (), 10.0))
  (0.6036363636363636, (:linear, (), 50.0))
  (0.6036363636363636, (:linear, (), 100.0))
  (0.6036363636363636, (:polynomial, 2, 0.05))
  (0.6036363636363636, (:polynomial, 2, 0.1))
  (0.6036363636363636, (:polynomial, 2, 0.5))
  (0.6036363636363636, (:polynomial, 2, 1.0))
  (0.6036363636363636, (:polynomial, 2, 5.0))
  ⋮
  (0.6036363636363636, (:gauss, 4, 5.0))
  (0.6036363636363636, (:gauss, 4, 10.0))
  (0.6036363636363636, (:gauss, 4, 50.0))
  (0.6036363636363636, (:gauss, 4, 100.0))
  (0.6036363636363636, (:gauss, 5, 0.05))
  (0.6036363636363636, (:gauss, 5, 0.1))
  (0.6036363636363636, (:gauss, 5, 0.5))
  (0.6036363636363636, (:gauss, 5, 1.0))
  (0.6036363636363636, (:gauss, 5, 5.0))
  (0.6036363636363636, (:gauss, 5, 10.0))
  (0.6036363636363636, (:gauss, 5, 50.0))
  (0.6036363636363636, (:gauss, 5, 100.0))
,#+END_EXAMPLE
#+end_example

#+begin_src jupyter-julia
best_chips = best_by_kernels(res_chips) 
#+end_src

#+RESULTS:
: # Out[70]:
: #+BEGIN_EXAMPLE
:   Dict{Any, Any} with 3 entries:
:   :polynomial => (0.559402, (:polynomial, 3, 50.0))
:   :linear     => (0.567949, (:linear, (), 50.0))
:   :gauss      => (0.559829, (:gauss, 4, 10.0))
: #+END_EXAMPLE

#+begin_src jupyter-julia
best_geyser = best_by_kernels(res_geyser) 
#+end_src

#+RESULTS:
: # Out[57]:
: #+BEGIN_EXAMPLE
:   Dict{Any, Any} with 3 entries:
:   :polynomial => (0.603636, (:polynomial, 2, 0.05))
:   :linear     => (0.603636, (:linear, (), 0.05))
:   :gauss      => (0.603636, (:gauss, 1, 0.05))
: #+END_EXAMPLE


* Plots
#+begin_src jupyter-julia
using Plots 
using IterTools
#+end_src

#+RESULTS:
: # Out[6]:

#+begin_src jupyter-julia
Xm_chips = reduce(hcat, X_chips)
Xm_geyser = reduce(hcat, X_geyser)

function split_classes_for_plot(X, y)
    pN((x, y)) = y == -1
    pP((x, y)) = y == 1
    d((x, y)) = x
    XN = d.(filter(pN, collect(zip(X, y))))
    XP = d.(filter(pP, collect(zip(X, y))))
    return (XN, XP)
end
XN_chips, XP_chips = split_classes_for_plot(X_chips, y_chips)
XmN_chips = reduce(hcat, XN_chips)
XmP_chips = reduce(hcat, XP_chips)

XN_geyser, XP_geyser = split_classes_for_plot(X_geyser, y_geyser)
XmN_geyser = reduce(hcat, XN_geyser)
XmP_geyser = reduce(hcat, XP_geyser)
#+end_src

#+RESULTS:
: # Out[7]:
: #+BEGIN_EXAMPLE
:   2×88 Matrix{Float64}:
:   1.0  1.0  1.0  1.0  2.0  2.0  2.0  …  23.0  23.0  23.0  23.0  23.0  23.0
:   4.0  2.3  1.7  1.7  1.7  3.7  3.1      4.0   1.8   1.8   2.1   2.1   2.0
: #+END_EXAMPLE


#+begin_src jupyter-julia :results raw drawer
scatter_chips1 = scatter(XmN_chips[1, :], XmN_chips[2, :], c = :blue)
scatter_chips = scatter!(scatter_chips1, XmP_chips[1, :], XmP_chips[2, :], c = :red)
#+end_src


#+RESULTS:
:results:
# Out[8]:
[[file:./obipy-resources/Fj5GZc.svg]]
:end:

#+begin_src jupyter-julia :results raw drawer
scatter_geyser1 = scatter(XmN_geyser[1, :], XmN_geyser[2, :], c = :blue)
scatter_geyser = scatter!(scatter_geyser1, XmP_geyser[1, :], XmP_geyser[2, :], c = :red)
#+end_src

#+RESULTS:
:results:
# Out[9]:
[[file:./obipy-resources/7mfeot.svg]]
:end:

#+begin_src jupyter-julia
function with_scatter(p, XmN, XmP)
    scatter1 = scatter(p, XmN[1, :], XmN[2, :], c = :red)
    scatter(scatter1, XmP[1, :], XmP[2, :], c = :blue)
end

function plot_best(best, kern, X, y)
    Xm = reduce(hcat, X)
    XN, XP = split_classes_for_plot(X, y)
    XmN = reduce(hcat, XN)
    XmP = reduce(hcat, XP)

    _, (kern, kern_param, C) = best[kern]
    cls = mk_svc(kern, kern_param, size(X)[1]; C=C)
    fit_svc(cls, X, y)

    f(x1, x2) = predict(cls, [x1, x2])
    rx = range(minimum(Xm[1, :]),stop=maximum(Xm[1, :]),length=100)
    ry = range(minimum(Xm[2, :]),stop=maximum(Xm[2, :]),length=100)

    p = heatmap(rx, ry, f, c = :redsblues, clims=(-1, 1))
    with_scatter(p, XmN, XmP)
end
#+end_src

#+RESULTS:
: # Out[17]:
: : plot_best (generic function with 1 method)

** chips

#+begin_src jupyter-julia :results raw drawer
plot_best(best_chips, :linear, X_chips, y_chips)
#+end_src

#+RESULTS:
:results:
# Out[76]:
[[file:./obipy-resources/fEqHl6.svg]]
:end:


#+begin_src jupyter-julia :results raw drawer
plot_best(best_chips, :polynomial, X_chips, y_chips)
#+end_src

#+RESULTS:
:results:
# Out[77]:
[[file:./obipy-resources/NhZWOC.svg]]
:end:

#+begin_src jupyter-julia :results raw drawer
plot_best(best_chips, :gauss, X_chips, y_chips)
#+end_src

#+RESULTS:
:results:
# Out[78]:
[[file:./obipy-resources/SEyVAO.svg]]
:end:

** geyser

#+begin_src jupyter-julia :results raw drawer
plot_best(best_geyser, :linear, X_geyser, y_geyser)
#+end_src

#+RESULTS:
:results:
# Out[21]:
[[file:./obipy-resources/x7JKiA.svg]]
:end:

#+begin_src jupyter-julia :results raw drawer
plot_best(best_geyser, :polynomial, X_geyser, y_geyser)
#+end_src

#+RESULTS:
:results:
# Out[22]:
[[file:./obipy-resources/WBbdkB.svg]]
:end:

#+begin_src jupyter-julia :results raw drawer
plot_best(best_geyser, :gauss, X_geyser, y_geyser)
#+end_src

#+RESULTS:
:results:
# Out[23]:
[[file:./obipy-resources/cdzXQM.svg]]
:end:
